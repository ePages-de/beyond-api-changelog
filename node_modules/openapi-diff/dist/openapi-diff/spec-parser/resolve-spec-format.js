"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const open_api_diff_error_impl_1 = require("../../common/open-api-diff-error-impl");
const is_swagger2_content_1 = require("./swagger2/is-swagger2-content");
const detectContentFormat = (specContent) => is_swagger2_content_1.isSwagger2Content(specContent) ? 'swagger2' : 'openapi3';
const typeSafeSupportedFormats = {
    openapi3: null,
    swagger2: null
};
const supportedFormats = Object.keys(typeSafeSupportedFormats);
const isSpecFormat = (unverifiedFormat) => supportedFormats.indexOf(unverifiedFormat) >= 0;
const toVerifiedFormat = (spec) => {
    if (!isSpecFormat(spec.unverifiedFormat)) {
        throw new open_api_diff_error_impl_1.OpenApiDiffErrorImpl('OPENAPI_DIFF_PARSE_ERROR', `"${spec.location}" format "${spec.unverifiedFormat}" is not supported`);
    }
    return spec.unverifiedFormat;
};
const autoDetectFormat = 'auto-detect';
const isAutoDetect = (unverifiedFormat) => unverifiedFormat === autoDetectFormat;
exports.resolveSpecFormat = (spec) => isAutoDetect(spec.unverifiedFormat)
    ? detectContentFormat(spec.content)
    : toVerifiedFormat(spec);
